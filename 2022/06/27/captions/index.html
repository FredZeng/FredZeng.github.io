<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#f8f5ec"><meta name="msapplication-navbutton-color" content="#f8f5ec"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec"><meta name="description" content="字幕"><meta property="og:title" content="字幕"><meta property="og:description" content="字幕"><meta name="keywords" content="FredZeng,FredTsang,Blog,TF5,TECH F5VE"><link rel="alternate" href="/atom.xml" title="FredTsang"><link rel="canonical" href="https://fredzeng.github.io/2022/06/27/captions/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/css/style.css?v="><script id="baidu_push">!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script>window.config={leancloud:"",toc:!0,fancybox:"",pjax:"",latex:""}</script><title>字幕 - FredTsang</title></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"> <a href="/." class="logo">FredTsang</a></div><div class="mobile-navbar-icon"><span></span><span></span><span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">Home</li></a><a href="/archives/"><li class="mobile-menu-item">Archives</li></a><a href="/categories/"><li class="mobile-menu-item">Categories</li></a></ul></nav><div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper"> <a href="/." class="logo">FredTsang</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"> <a class="menu-item-link" href="/">Home</a></li><li class="menu-item"> <a class="menu-item-link" href="/archives/">Archives</a></li><li class="menu-item"> <a class="menu-item-link" href="/categories/">Categories</a></li></ul></nav></header><main id="main" class="main"><div class="content-wrapper"><div id="content" class="content"><article class="post"><header class="post-header"><h1 class="post-title">字幕</h1><div class="post-meta"> <span class="post-time">2022-06-27</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">Contents</h2><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#视频字幕"><span class="toc-text">视频字幕</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-ffmpeg-给-mp4-添加内挂字幕："><span class="toc-text">使用 ffmpeg 给 mp4 添加内挂字幕：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-ffmpeg-给-mp4-添加内挂字幕，并转为-mkv："><span class="toc-text">使用 ffmpeg 给 mp4 添加内挂字幕，并转为 mkv：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-ffmpeg-给-mp4-添加多个内挂字幕，并转为-mkv："><span class="toc-text">使用 ffmpeg 给 mp4 添加多个内挂字幕，并转为 mkv：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#srt-字幕"><span class="toc-text">srt 字幕</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#H5-视频字幕"><span class="toc-text">H5 视频字幕</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WebVTT-字幕"><span class="toc-text">WebVTT 字幕</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="视频字幕"><a href="#视频字幕" class="headerlink" title="视频字幕"></a>视频字幕</h2><p>对于常见的视频（如 mp4、mkv）而言，根据字幕信息嵌入到视频中的方式，可以把字幕分为硬字幕和软字幕；</p><p><strong>硬字幕</strong>是指字幕以图像的方式和视频画面相融合并硬编码在视频文件中，因此我们无法直接从视频中提取、编辑或删除字幕；由于硬字幕作为视频画面的一部分，因此可以保证在任何设备和任何播放器上看到的字幕都是完全一样的，不会有字体、位置等差异；想要从视频中提取出硬字幕，可以使用 OCR 从视频帧中识别字幕文本，从而生成 srt 等字幕文件。</p><p><strong>软字幕</strong>根据字幕的加载/封装方式，可以分为内挂字幕和外挂字幕。（在部分资料中，会把内挂字幕等同于软字幕，而外挂字幕作为另一种类型）</p><ul><li><p>内挂字幕：一般指字幕文件和视频（音频流+视频流）一同封装在（MP4、MKV）视频文件中，播放时需要经过播放器处理解析显示。字幕文件以字幕流/字幕轨的方式存在于视频文件中，一个视频可以有多个内挂字幕（即多路字幕流），用户可通过播放器切换要显示的字幕。</p></li><li><p>外挂字幕：指字幕以单独的文件格式存在，常见的类型有 srt、ass、vtt 等；在播放视频时，用户需要手动导入/打开字幕文件；在同一目录下，如果字幕文件名和视频文件名相同时，部分播放器能够自动加载字幕，否则需要手动打开。</p></li></ul><p>软字幕的显示都需要播放器的支持，一般能够支持 mp4、mkv 和 webm；</p><ul><li>修改外挂字幕，只需要修改对应的字幕文件即可；</li><li>修改内挂字幕，则需要使用相关工具对字幕流/字幕轨进行修改。</li></ul><h3 id="使用-ffmpeg-给-mp4-添加内挂字幕："><a href="#使用-ffmpeg-给-mp4-添加内挂字幕：" class="headerlink" title="使用 ffmpeg 给 mp4 添加内挂字幕："></a>使用 ffmpeg 给 mp4 添加内挂字幕：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i sintel-short.mp4 -i sintel-en.srt -c copy -c:s mov_text sintel-short-en.mp4</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/windows-mp4.png" alt="windows-mp4" loading="lazy"></p><p>【Windows 默认播放器，播放时无字幕】</p><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/vlc-mp4.png" alt="vlc-mp4" loading="lazy"></p><p>【VLC 播放器，播放时需要选择字幕】</p><h3 id="使用-ffmpeg-给-mp4-添加内挂字幕，并转为-mkv："><a href="#使用-ffmpeg-给-mp4-添加内挂字幕，并转为-mkv：" class="headerlink" title="使用 ffmpeg 给 mp4 添加内挂字幕，并转为 mkv："></a>使用 ffmpeg 给 mp4 添加内挂字幕，并转为 mkv：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i sintel-short.mp4 -i sintel-en.srt -c copy -c:s copy sintel-short-en.mkv</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/windows-mkv.png" alt="windows-mkv" loading="lazy"></p><p>【Windows 默认播放器，播放时需要选择字幕】</p><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/vlc-mkv.png" alt="vlc-mkv" loading="lazy"></p><p>【VLC 播放器，播放时会自动显示字幕】</p><h3 id="使用-ffmpeg-给-mp4-添加多个内挂字幕，并转为-mkv："><a href="#使用-ffmpeg-给-mp4-添加多个内挂字幕，并转为-mkv：" class="headerlink" title="使用 ffmpeg 给 mp4 添加多个内挂字幕，并转为 mkv："></a>使用 ffmpeg 给 mp4 添加多个内挂字幕，并转为 mkv：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i sintel-short.mp4 -i sintel-en.srt -i sintel-de.srt \</span><br><span class="line">        -map 0:v -map 0:a -map 1 -map 2 \</span><br><span class="line">        -c copy -c:s copy \</span><br><span class="line">        -metadata:s:s:0 language=eng -metadata:s:s:1 language=deu \</span><br><span class="line">        sintel-short-mul.mkv</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/windows-mkv-mul.png" alt="windows-mkv-mul" loading="lazy"></p><p>【Windows 默认播放器，播放时可以切换字幕】</p><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/vlc-mkv-mul.png" alt="vlc-mkv-mul" loading="lazy"></p><p>【VLC 播放器，播放时可以切换字幕】</p><blockquote><p>可以看到，给 mp4 添加字幕时我们使用的是 -c:s mov_text，而给 mkv 添加字幕时我们使用的是 -c:s copy；<br>-c:s 是 -scodec 的简写，它用于设置字幕的编码类型；<br>对于 mp4 而言，我们需要指定使用 mov_text 编码器去处理字幕轨/字幕流。</p><p>常见的字幕编码器（-c:s）参数：<br>对于 MKV：copy,ass,srt,ssa<br>对于 MP4：copy,mov_text（如果是给 MP4 添加字幕，只能用 mov_text）<br>对于 MOV：copy,mov_text</p></blockquote><h3 id="srt-字幕"><a href="#srt-字幕" class="headerlink" title="srt 字幕"></a>srt 字幕</h3><p>srt 是一种比较流行的文本字幕格式，可以使用系统自带的文本编辑器来打开</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">00:00:00,000 --&gt; 00:00:12,000</span><br><span class="line">[Test]</span><br><span class="line">​</span><br><span class="line">2</span><br><span class="line">00:00:18,700 --&gt; 00:00:21,500</span><br><span class="line">This blade has a dark past.</span><br><span class="line">​</span><br><span class="line">3</span><br><span class="line">00:00:22,800 --&gt; 00:00:26,800</span><br><span class="line">It has shed much innocent blood.</span><br><span class="line">​</span><br><span class="line">4</span><br><span class="line">00:00:29,000 --&gt; 00:00:32,450</span><br><span class="line">You&apos;re a fool for traveling alone,</span><br><span class="line">so completely unprepared.</span><br></pre></td></tr></table></figure><h2 id="H5-视频字幕"><a href="#H5-视频字幕" class="headerlink" title="H5 视频字幕"></a>H5 视频字幕</h2><p>H5 视频字幕与普通的视频字幕相类似，也可以分为硬字幕和软字幕；硬字幕依然是已经将字幕内容编码在视频画面中，使得我们在不同的浏览器、不同的设备（移动端、PC端）能看到一样的效果。</p><p>H5 并不会从 mp4 视频中解析并显示内挂字幕，但它支持通过使用 <code>&lt;track&gt;</code> 元素为视频指定外挂字幕；外挂字幕的文件格式为 WebVTT，其文件名后缀一般为 <code>.vtt</code>，其 MIME 类型为 <code>text/vtt</code>；</p><p>在 Chrome 和 Firefox 浏览器下，.vtt 字幕是可以无障碍加载显示的，但是对于IE10+浏览器，虽然也支持.vtt字幕，但是需要定义 MIME type，否则会无视WebVTT格式。</p><p>为<code>&lt;video&gt;</code>添加多个字幕：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"video"</span> <span class="attr">preload</span>=<span class="string">"metadata"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"video/sintel-short.mp4"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 英语（因为设置了 default 属性，所以会默认启用英语字幕） --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">track</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">"English"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">kind</span>=<span class="string">"subtitles"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">srclang</span>=<span class="string">"en"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"subtitles/vtt/sintel-en.vtt"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">default</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 德语 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">track</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">"Deutsch"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">kind</span>=<span class="string">"subtitles"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">srclang</span>=<span class="string">"de"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"subtitles/vtt/sintel-de.vtt"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 西班牙语 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">track</span></span></span><br><span class="line"><span class="tag">    <span class="attr">label</span>=<span class="string">"Español"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">kind</span>=<span class="string">"subtitles"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">srclang</span>=<span class="string">"es"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"subtitles/vtt/sintel-es.vtt"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/images/multi-track.png" alt="multi-track" loading="lazy"></p><h3 id="WebVTT-字幕"><a href="#WebVTT-字幕" class="headerlink" title="WebVTT 字幕"></a>WebVTT 字幕</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">WEBVTT</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">00:00:00.000 --&gt; 00:00:12.000</span><br><span class="line">&lt;v Test&gt;[Test]&lt;/v&gt;</span><br><span class="line">​</span><br><span class="line">NOTE This is a comment and must be preceded by a blank line</span><br><span class="line">​</span><br><span class="line">1</span><br><span class="line">00:00:18.700 --&gt; 00:00:21.500</span><br><span class="line">This blade has a dark past.</span><br><span class="line">​</span><br><span class="line">2</span><br><span class="line">00:00:22.800 --&gt; 00:00:26.800</span><br><span class="line">It has shed much innocent blood.</span><br><span class="line">​</span><br><span class="line">3</span><br><span class="line">00:00:29.000 --&gt; 00:00:32.450</span><br><span class="line">You&apos;re a fool for traveling alone,</span><br><span class="line">so completely unprepared.</span><br><span class="line">​</span><br><span class="line">4</span><br><span class="line">00:00:32.750 --&gt; 00:00:35.800</span><br><span class="line">You&apos;re lucky your blood&apos;s still flowing.</span><br></pre></td></tr></table></figure><p>可以看到，vtt 字幕的文本格式和 srt 字幕相似；其中，WebVTT 字幕须以 WebVTT 开头，以表明这是 WebVTT 字幕。</p><blockquote><p>使用 ffmpeg -i input.srt output.vtt 可以将 srt 文件转为 vtt 文件</p></blockquote><p>此外，在CSS中提供了专门的伪元素<code>::cue</code>来控制字幕的样式，可以控制的 CSS 属性包括：</p><ul><li>color</li><li>opacity</li><li>visibility</li><li>text-decoration</li><li>text-shadow</li><li>background 及相关属性</li><li>outline 及相关属性</li><li>font 及相关属性，包括 line-height</li><li>white-space</li></ul><p>因此，我们可以通过修改::cue伪元素样式，来控制 H5 <code>&lt;video&gt;</code> 字幕样式；</p><p>但是，原生的字幕样式控制，由于CSS属性上的限制，我们不能修改字幕出现的位置、实现更复杂的排版等，我们是否可以对字幕有更全面的样式控制？</p><p>在 video.js 中，提供了 TextTrackDisplay 组件来显示字幕；它将字幕内容渲染在 div 中，并以绝对定位的方式覆盖到视频上，使得我们可以修改所有的 CSS 属性。</p><p>缺点：部分移动端浏览器（如 iOS 浏览器、部分华为系统浏览器），全屏后会被系统劫持播放器样式，导致自定义播放器组件不显示，引起字幕不显示的问题；因此，在 video.js 的字幕实现中，会根据 user-agent 选择使用原生或 TextTrackDisplay 组件来显示字幕。</p></div><footer class="post-footer"><nav class="post-nav"><a class="prev" href="/2022/07/06/tools/"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">常用在线工具</span> <span class="prev-text nav-mobile">Prev</span></a> <a class="next" href="/2022/06/27/tools/imagemin/"><span class="next-text nav-default">node.js 图片压缩</span> <span class="prev-text nav-mobile">Next</span><i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="comments" id="comments"></div></div></main><footer id="footer" class="footer"><div class="social-links"><a href="https://github.com/FredZeng" class="iconfont icon-github" title="github"></a></div><div class="copyright"> <span class="power-by">Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a></span> <span class="division">|</span> <span class="theme-info">Theme - <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a></span> <span class="copyright-year">&copy;2019 - 2024<span class="heart"><i class="iconfont icon-heart"></i></span> <span class="author">FredTsang</span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/lib/jquery/jquery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/lib/slideout/slideout.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/js/src/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/js/src/clipboard-use.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/FredZeng/FredZeng.github.io@master/js/src/even.js?v="></script></body></html>