!function(a){"use strict";function t(t){this.config=t}t.prototype.setup=function(){var t=this.config.leancloud;this.navbar(),this.responsiveTable(),this.config.toc&&(this.scrollToc(),this.tocFollow()),this.config.fancybox&&this.fancybox(),t.app_id&&t.app_key&&this.recordReadings(),this.config.latex&&this.renderLaTeX(),this.backToTop()},t.prototype.navbar=function(){var t=$("#mobile-navbar"),e=$(".mobile-navbar-icon"),o=new Slideout({panel:document.getElementById("mobile-panel"),menu:document.getElementById("mobile-menu"),padding:180,tolerance:70});o.disableTouch(),e.click(function(){o.toggle()}),o.on("beforeopen",function(){t.addClass("fixed-open"),e.addClass("icon-click").removeClass("icon-out")}),o.on("beforeclose",function(){t.removeClass("fixed-open"),e.addClass("icon-out").removeClass("icon-click")}),$("#mobile-panel").on("touchend",function(){o.isOpen()&&e.click()})},t.prototype.responsiveTable=function(){$(".post-content > table").wrap('<div class="table-responsive">')},t.prototype.scrollToc=function(){var n,c=$(".post-toc"),i=$(".post-footer");c.length&&(n=c.offset().top-20,$(a).scroll(function(){var t,e,o={start:{position:"absolute",top:n},process:{position:"fixed",top:20}};$(a).scrollTop()<n?c.css(o.start):(c.css(o.process),"none"!=$(".post-toc").css("display")&&(o=i.offset().top-c.height()-20,t=document.documentElement.scrollTop+a.innerHeight/2,null!=$(".toc-link.active").offset()&&$(".toc-link.active").offset().top>t&&(e=$(".post-toc").offset().top-$(".toc-link.active").offset().top,$(".post-toc").offset({top:Math.min(o,t+e)})),o<$(".post-toc").offset().top&&$(".post-toc").offset({top:o})))}))},t.prototype.tocFollow=function(){var i=$(".toc-link"),s=$(".headerlink");$(a).scroll(function(){for(var t=$.map(s,function(t){return $(t).offset().top}),e=$(a).scrollTop(),o=0;o<i.length;o++){var n=o+1===i.length,c=t[o]-30,n=n?1/0:t[o+1]-30;c<e&&e<=n?$(i[o]).addClass("active"):$(i[o]).removeClass("active")}})},t.prototype.fancybox=function(){$.fancybox&&($(".post").each(function(){$(this).find("img").each(function(){var t='href="'+this.src+'"',e='title="'+this.alt+'"';$(this).wrap('<a class="fancybox" '+t+" "+e+"></a>")})}),$(".fancybox").fancybox({openEffect:"elastic",closeEffect:"elastic"}))},t.prototype.recordReadings=function(){if("object"==typeof AV){var o,n,c,i=$(".post-visits"),e=AV.Object.extend("Counter");if(1!==i.length){var s=e;let t=0;i.each(function(){var o=$(this);setTimeout(function(){var t=new AV.Query(s),e=o.data("url").trim();t.equalTo("url",e),t.find().then(function(t){0===t.length?a(o,0):(t=t[0],a(o,t.get("time")))},function(t){console.log("Error:"+t.code+" "+t.message)})},100*t++)})}else o=e,e=new AV.Query(o),n=i.data("url").trim(),c=i.data("title").trim(),e.equalTo("url",n),e.find().then(function(t){var e;0<t.length?t[0].save(null,{fetchWhenSave:!0}).then(function(t){return t.increment("time",1),t.save()}).then(function(t){a(i,t.get("time"))}):((e=new o).set("title",c),e.set("url",n),e.set("time",1),(t=new AV.ACL).setWriteAccess("*",!0),t.setReadAccess("*",!0),e.setACL(t),e.save().then(function(){a(i,e.get("time"))}))},function(t){console.log("Error:"+t.code+" "+t.message)})}function a(t,e){e=t.text().replace(/(\d+)/i,e);t.text(e)}},t.prototype.backToTop=function(){var t=$("#back-to-top");$(a).scroll(function(){100<$(a).scrollTop()?t.fadeIn(1e3):t.fadeOut(1e3)}),t.click(function(){$("body,html").animate({scrollTop:0})})},t.prototype.renderLaTeX=function(){var e=setInterval(function(){var t;a.MathJax&&((t=a.MathJax).Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}}),t.Hub.Queue(["Typeset",t.Hub,$(document.body)[0]]),clearInterval(e))},500)},new t(a.config).setup()}(window);