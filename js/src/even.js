!function(a){function t(t){this.config=t}t.prototype.setup=function(){var t=this.config.leancloud;this.navbar(),this.responsiveTable(),this.config.toc&&(this.scrollToc(),this.tocFollow()),this.config.fancybox&&this.fancybox(),t.app_id&&t.app_key&&this.recordReadings(),this.config.latex&&this.renderLaTeX(),this.backToTop()},t.prototype.navbar=function(){var t=$("#mobile-navbar"),o=$(".mobile-navbar-icon"),e=new Slideout({panel:document.getElementById("mobile-panel"),menu:document.getElementById("mobile-menu"),padding:180,tolerance:70});e.disableTouch(),o.click(function(){e.toggle()}),e.on("beforeopen",function(){t.addClass("fixed-open"),o.addClass("icon-click").removeClass("icon-out")}),e.on("beforeclose",function(){t.removeClass("fixed-open"),o.addClass("icon-out").removeClass("icon-click")}),$("#mobile-panel").on("touchend",function(){e.isOpen()&&o.click()})},t.prototype.responsiveTable=function(){$(".post-content > table").wrap('<div class="table-responsive">')},t.prototype.scrollToc=function(){var n,c=$(".post-toc"),i=$(".post-footer");c.length&&(n=c.offset().top-20,$(a).scroll(function(){var t,o,e={start:{position:"absolute",top:n},process:{position:"fixed",top:20}};$(a).scrollTop()<n?c.css(e.start):(c.css(e.process),"none"!=$(".post-toc").css("display")&&(e=i.offset().top-c.height()-20,t=document.documentElement.scrollTop+a.innerHeight/2,null!=$(".toc-link.active").offset()&&$(".toc-link.active").offset().top>t&&(o=$(".post-toc").offset().top-$(".toc-link.active").offset().top,$(".post-toc").offset({top:Math.min(e,t+o)})),e<$(".post-toc").offset().top)&&$(".post-toc").offset({top:e}))}))},t.prototype.tocFollow=function(){var i=$(".toc-link"),s=$(".headerlink");$(a).scroll(function(){for(var t=$.map(s,function(t){return $(t).offset().top}),o=$(a).scrollTop(),e=0;e<i.length;e++){var n=e+1===i.length,c=t[e]-30,n=n?1/0:t[e+1]-30;c<o&&o<=n?$(i[e]).addClass("active"):$(i[e]).removeClass("active")}})},t.prototype.fancybox=function(){$.fancybox&&($(".post").each(function(){$(this).find("img").each(function(){var t='href="'+this.src+'"',o='title="'+this.alt+'"';$(this).wrap('<a class="fancybox" '+t+" "+o+"></a>")})}),$(".fancybox").fancybox({openEffect:"elastic",closeEffect:"elastic"}))},t.prototype.recordReadings=function(){if("object"==typeof AV){var e,n,c,i=$(".post-visits"),o=AV.Object.extend("Counter");if(1!==i.length){var s=o;let t=0;i.each(function(){var e=$(this);setTimeout(function(){var t=new AV.Query(s),o=e.data("url").trim();t.equalTo("url",o),t.find().then(function(t){0===t.length?a(e,0):(t=t[0],a(e,t.get("time")))},function(t){console.log("Error:"+t.code+" "+t.message)})},100*t++)})}else e=o,o=new AV.Query(e),n=i.data("url").trim(),c=i.data("title").trim(),o.equalTo("url",n),o.find().then(function(t){var o;0<t.length?t[0].save(null,{fetchWhenSave:!0}).then(function(t){return t.increment("time",1),t.save()}).then(function(t){a(i,t.get("time"))}):((o=new e).set("title",c),o.set("url",n),o.set("time",1),(t=new AV.ACL).setWriteAccess("*",!0),t.setReadAccess("*",!0),o.setACL(t),o.save().then(function(){a(i,o.get("time"))}))},function(t){console.log("Error:"+t.code+" "+t.message)})}function a(t,o){o=t.text().replace(/(\d+)/i,o);t.text(o)}},t.prototype.backToTop=function(){var t=$("#back-to-top");$(a).scroll(function(){100<$(a).scrollTop()?t.fadeIn(1e3):t.fadeOut(1e3)}),t.click(function(){$("body,html").animate({scrollTop:0})})},t.prototype.renderLaTeX=function(){var o=setInterval(function(){var t;a.MathJax&&((t=a.MathJax).Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}}),t.Hub.Queue(["Typeset",t.Hub,$(document.body)[0]]),clearInterval(o))},500)},new t(a.config).setup()}(window);